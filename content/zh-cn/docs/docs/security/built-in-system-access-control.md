内置系统访问控制
==============================

系统访问控制插件在任何连接器级别授权之前，在全局级别强制授权。您可以使用Presto中内置的插件，也可以按照【系统访问控制】（../develop/system-access-control）中的指导提供自己的插件。Presto提供了三个内置插件：

|插件名称|说明|
| :-------------------------- | :----------------------------------------------------------- |
| `allow-all`（缺省值） |允许所有操作。|
| `read-only` |允许读数据或元数据的操作，但不允许写数据或元数据的操作。有关详细信息，请参阅“只读系统访问控制”。|
| `file` |授权检查使用配置属性`security.config-file`指定的配置文件执行。有关详细信息，请参阅“基于文件的系统访问控制”。|

允许所有系统访问控制
-------------------------------

插件允许所有操作。插件默认开启。

只读系统访问控制
-------------------------------

在此插件下，您可以执行任何读取数据或元数据的操作，例如`SELECT`或`SHOW`。还允许设置系统级或目录级会话属性。但是，任何
禁止写入数据或元数据的操作，如`CREATE`、`INSERT`、`DELETE`。要使用该插件，请添加`etc/access-control.properties`文件，内容如下：

"```{.none}"
access-control.name=只读访问控制
```

基于文件的系统访问控制
--------------------------------

此插件允许您在文件中指定访问控制规则。要使用该插件，请添加一个`etc/access-control.properties`文件，其中包含两个必需的属性：`access-control.name`，必须等于`file`;`security.config-file`，必须等于config文件的位置。例如，`etc`目录下有名为`rules.json`的配置文件，则添加`etc/access-control.properties`文件，内容如下：

"```{.none}"
access-control.name=访问控制文件名
security.config-file=配置文件规则文件
```

config文件以json格式指定。

+它包含定义哪个目录可以由哪个用户访问的规则（见下面的目录规则）。
-明确哪些主体可以标识为哪些用户的主要规则（见下文的主要规则）。

此插件目前仅支持目录访问控制规则和主体规则。如果您想以任何其他方式限制对系统级别的访问，您必须实现一个自定义的SystemAccessControl插件(请参见
【系统-访问控制】（../develop/系统-访问控制`）。

###刷新

默认情况下，当对`security.config-file`进行更改时，必须重新启动Presto以加载更改。有一个可选的属性来刷新属性，而不需要Presto重新启动。刷新周期在`etc/access-control.properties`中指定：

"```{.none}"
security.refresh-period=1秒后刷新一次
```

###目录规则

这些规则控制特定用户可以访问的目录。根据从上到下读取的第一个匹配规则，授予用户访问目录的权限。如果没有匹配到任何规则，则拒绝访问。每条规则
由以下字段组成：

- `user`（可选）：与用户名匹配的正则表达式。默认为`.*`。
- `catalog`（可选）:regex，与目录名匹配。默认为`.*`。
- `allow`（必需）:boolean，表示用户是否有访问目录的权限


**说明**

*默认情况下，所有用户都可以访问`system`目录。您可以通过添加规则来覆盖此行为。*


例如，如果希望仅允许`admin`用户访问`mysql`和`system`目录，允许所有用户访问`hive`目录，拒绝其他用户访问，则可以使用以下规则：

"``` {.json}"
{
"目录": [
{
"user": "管理员"，
"catalog": "（mysql|系统数据库）"，
"allow": "true"：允许通过
}，
{
"catalog": "头像"，
"allow": "true"：允许通过
}，
{
"catalog":"系统"，
"allow"：假的
}
]
}
```

###基本原则

这些规则用于强制主体和指定的用户名之间的特定匹配。主体作为用户被授权
基于从上到下读取的第一匹配规则。如果没有指定规则，则不进行检查。如果没有匹配到任何规则，则拒绝用户授权。每条规则由以下字段组成：

- `principal`（必需）：要匹配的正则表达式和针对principal的组。
- `user`（可选）：与用户名匹配的正则表达式。如果匹配成功，则根据`allow`的值进行授权或拒绝授权。
- `principal_to_user`（可选）：针对principal进行替换的字符串。如果替换的结果与用户名相同，它将基于
允许值。
- `allow`（必须）:boolean，表示是否允许被授权人作为用户。


**说明**

*你至少要在一条主要规则中指定一个标准。如果在主体规则中同时指定了两个条件，当满足其中一个条件时，主体规则将返回期望的结论。*

LDAP认证和Kerberos认证的principal名称全匹配：

"``` {.json}"
{
"目录": [
{
"allow": "true"：允许通过
}
]，
"校长": [
{
"principal": "(.*)"，
"主子账号":"$1"，
"allow": "true"：允许通过
}，
{
"principal": "([^/]+)(/.*)?@.*"，
"主子账号":"$1"，
"allow": "true"：允许通过
}
]
}
```

如果您希望允许用户使用与其Kerberos主体名称相同的提取名称，并且允许`alice`和`bob`使用名为`group@example.net`的组主体，那么可以使用以下规则。

"``` {.json}"
{
"目录": [
{
"allow": "true"：允许通过
}
]，
"校长": [
{
"principal": "([^/]+)/?.*@example.net"，
"主子账号":"$1"，
"allow": "true"：允许通过
}，
{
"principal": "所属组@示例.net"，
"user": "alice|bob"，
"allow": "true"：允许通过
}
]
}
```
