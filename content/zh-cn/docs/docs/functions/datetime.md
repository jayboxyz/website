日期和时间函数和运算符
=====================================

日期和时间运算符
-----------------------

|运算符|示例|结果|
| :------- | :-------------------------------------------------- | :------------------------ |
| `+` | `日期'2012-08-08' +时间间隔'2'天` | `2012-08-10` |
| `+` | `时间'01:00' +间隔'3'小时` | `04:00:00.000` |
| `+` | `时间戳'2012-08-08 01:00' +时间间隔'29' hour` | `2012-08-09 06:00:00.000` |
| `+` | `时间戳'2012-10-31 01:00' +时间间隔'1'月` | `2012-11-30 01:00:00.000` |
| `+` | `间隔'2'天+间隔'3'小时` | `2 03:00:00.000` |
| `+` | `间隔'3'年+间隔'5'月` | `3-5` |
| `-` | `date '2012-08-08' -时间间隔'2'天` | `2012-08-06` |
| `-` | `时间'01:00' -间隔时间'3'小时` | `22:00:00.000` |
| `-` | `时间戳'2012-08-08 01:00' -时间间隔'29'小时` | `2012-08-06 20:00:00.000` |
| `-` | `时间戳'2012-10-31 01:00' -时间间隔'1'月` | `2012-09-30 01:00:00.000` |
| `-` | `间隔'2'天-间隔'3'小时` | `1 21:00:00.000` |
|````间隔'3'年-间隔'5'月```2-7`|

时区转换
--------------------

`AT TIME ZONE`运算符设置时间戳的时区：

SELECT时间戳'2012-10-31 01:00 UTC时间'；
2012年10月31日01:00:00.000（世界标准时间）
    
SELECT时间戳'2012-10-31 01:00 UTC'在时区'America/Los_Angeles'；
2012-10-30 18:00:00.000美国/洛杉矶

日期和时间函数
-----------------------

**当前\_日期** -\>日期

返回查询开始时的当前日期。


**current\_time** -\>带时区的时间

返回从查询开始的当前时间。


current\_timestamp -\>带时区的时间戳

返回查询开始时的当前时间戳。


**current\_timezone()** -\> varchar

以IANA定义的格式（如`America/Los_Angeles`）或从UTC固定偏移（如`+08:35`）返回当前时区。


**日期(x)** -\>日期

这是`CAST(x AS date)`的别名。


from\_iso8601\_时间戳(string)** -\>带时区的时间戳

将ISO8601格式`string`解析成`带时区的时间戳`。


**from\_iso8601\_date(string)** -\>日期时间格式

将ISO 8601格式的`string`解析成`date`。


**from\_unixtime(unixtime)** -\>时间戳信息

将UNIX时间戳`unixtime`作为时间戳返回。`unixtime`表示从`1970-01-01 00:00:00`以来的秒数。

from\_unixtime(unixtime, string)带时区的时间戳

将UNIX时间戳`unixtime`作为时间戳返回，时区使用`string`。`unixtime`表示从`1970-01-01 00:00:00`以来的秒数。

**from\_unixtime(unixtime,hours,minutes)** -\>带时区的时间戳格式

将UNIX时间戳`unixtime`作为时间戳返回，使用`hours`和`minutes`作为时区偏移量。`unixtime`表示从`1970-01-01 00:00:00`以来的秒数。

**localtime** -\>时间信息

返回从查询开始的当前时间。

**本地时间戳** -\>时间戳

返回查询开始时的当前时间戳。

now()** -\>带时区的时间戳

这是`current_timestamp`的别名。


**to\_iso8601(x)** -\> varchar

将`x`格式化为ISO 8601字符串。`x`可以是日期、时间戳或带时区的时间戳。


**to\_msilliseconds(interval)** -\>比格因特

返回以毫秒为单位的天到秒的`间隔`。


**to\_unixtime（时间戳）** -\>加倍

将`timestamp`作为UNIX时间戳返回。


**说明**

以下SQL标准函数没有使用括号：

-当前日期
-当前时间
-当前时间戳
- "当地时间"
- "当地时间戳"


截断函数
-------------------

`date_trunc`函数支持的单位如下：

|单位|截断值示例|
| :-------- | :------------------------ |
秒秒2001年8月22日03:04:05.000秒
| `分钟` | `2001-08-22 03:04:00.000` |
| `小时` | `2001-08-22 03:00:00.000` |
| `日' | `2001年8月22日00:00:00.000` |
| `周` | `2001-08-20 00:00:00.000` |
| `月` | `2001-08-01 00:00:00.000` |
| `季度` | `2001-07-01 00:00:00.000` |
| `年份` | `2001-01-01 00:00:00.000` |

上述示例使用时间戳`2001-08-22 03:04:05.321`作为
输入。

**日期\_截断（单位，x）** -\> \【与输入相同\】

返回`x`截断为`unit`。


区间函数
------------------

本节中各功能支持以下间隔单位：

 

|单位|说明|
| :------------ | :----------------- |
| `毫秒` |毫秒|
秒秒
|分钟|分钟|
|小时|小时|
| `day` |天数|
|`week`|星期|
|`月`月|
一年的季度
年年年

**date\_add（单位，值，时间戳）** -\> \【同输入\】

在`timestamp`中添加一个类型为`unit`的区间`value`。可以用负值做减法。


**date\_diff（单位，timestamp1,timestamp2）** -\>大整数

返回`timestamp2-timestamp1`，以`unit`表示。


时长函数
-----------------

`parse_duration`函数支持以下单位：

 

|单位|说明|
| :--- | :----------- |
|纳秒|
| `us` |微秒|
| `ms` |毫秒|
秒秒
分钟
小时数
|`d``天|

**parse\_duration(string)** -\>解析间隔

将格式为`value unit`的`string`解析为一个区间，其中`value`为`unit`值的小数：

SELECT parse_duration（'42.8ms'）; -- 0凌晨0点043分0秒（42.8毫秒）
SELECT Parse_duration（'3.81 d'）; -- 3查询结果为19:26:24.000时，则返回该结果。
SELECT Parse_duration（'5m'）; -- 0 00:05:00.000（指定查询的解析时间长度）


MySQL日期函数
--------------------

本章节函数使用的格式字符串与MySQL的`date_parse`和`str_to_date`函数兼容。格式说明参考MySQL手册，格式说明如下表所示：

| Specifier |说明|
| --------- | ------------------------------------------------------------ |
| `%a` |工作日的缩写（`Sun` ..卫星） |
| `%b` |月份缩写（`Jan` .. (12月）|
| `%c` |月份，数字(`1` .. (#z) |（第12个字母）
| `%D` |月份中的第几天，带英文后缀（0、1、2、......） |
| `%d` |每月的星期几，数字（`01` ..第31条][4\]](#z）|
每月的星期几，数字（ 1 ..第31条][4\]](#z）|
| `%f` |秒的小数部分（打印6位：`000000`.. `999000`；解析1-9位：`0`.. `999999999`） [[1\]](#f) |
| `%H` |小时(`00` .. `23`) |
| `%h` |小时(`01` .. `12`) |
|`%I`|小时(`01`.. `12`) |
分钟，数字（'00' .. `59`） |
| `%j` |一年中的第几天(`001` .. `366`) |
| `%k` |小时(`0` .. `23`) |
|`%l`|小时(`1`.. `12`) |
| `%M` |月份名称（`一月` .. (12月）|
|`%m` |月份，数字(`01` .. (#z) |（第12个字母）
| `%p` | `AM`或`PM` |
| `%r` |时间，12小时制（`hh:mm:ss`后接`AM`或`PM`） |
| `%S` |秒(`00` .. `59`) |
| `%s` |秒(`00` .. `59`) |
| `%T` |时间，24小时制(`hh:mm:ss`) |
星期(00)。`53`)，其中星期日是一周的第一天|
星期(00)。`53`)，其中星期一是一周的第一天|
周（01.. `53`），其中Sunday是一周的第一天；与`%X`连用
星期（01.. `53'），其中星期一是一周的第一天；与`%x' |连用
| `%W` |工作日名称（`周日` ..星期六） |
| `%w` |一周中的第几天（`0` .. `6`），其中星期日是一周的第一天[[3\]](#w) |
| `%X` |星期几，其中星期日是星期的第一天，数字，四位；与`%V` |连用。
| `%x` |星期几，其中星期一是星期的第一天，数字，四位；与`%v` |连用
| `%Y` |年份，数字，四位|
| `%y` |年份，数字（2位） [[2\]](#y) |
| `%%` |一个字面的`%`字符|
| `%x` | `x`，对于上面没有列出的`x` |

| [[1\]](#id4) |时间戳截取为毫秒。|
| ------------ | --------------------------------------- |
| | |

| [[2\]](#id7) |解析时，两位年份格式假定为`1970` . `2069`，所以`70'将产生`1970`年，而`69'将产生`2069`年。|
| ------------ | ------------------------------------------------------------ |
| | |

| [[3\]](#id6) |暂不支持该标识。考虑使用[`day_of_week()`](#day_of_week)（它使用`1-7`而不是`0-6`） |
| ------------ | ------------------------------------------------------------ |
| | |

| [4] | *([1](#id1), [2](#id2), [3](#id3), [4](#id5))*此说明符不支持`0`作为月或日。|
| ---- | ------------------------------------------------------------ |
| | |

**提示**

目前不支持以下说明符：
"%D %U %u %V %w %X`"


**日期\_格式（时间戳，格式）** -\> varchar

使用`format`将`timestamp`格式化为字符串。


**日期\_解析（字符串，格式）** -\>时间戳

使用`format`将`string`解析成时间戳。


Java数据函数
-------------------

本节中的函数使用与JodaTime兼容的格式字符串
[DateTimeFormat]（http://joda-time.sourceforge.net/apidocs/org/joda/时间/格式/日期时间格式.html）表示日期时间格式。

**格式\_datetime（时间戳，格式）** -\> varchar

使用`format`将`timestamp`格式化为字符串。

**parse\_datetime（string，格式）** -\>带时区的时间戳

使用`format`将`string`解析成带时区的时间戳。


抽取功能
-------------------

`extract`函数支持以下字段：

|字段|说明|
| :---------------- | :----------------------------------------------------------- |
|年份|【年份( )】（ #年份）
|夸特（夸特） | （夸特） | （夸特） | （夸特） |
|`月' |【`月（）`】（#月） |
| `周' |【`week()`】(#week) |
| `DAY' | [`day()`](#day) |
|每月第几天第几天| [`day()`](#day) |
| `星期几的星期几' |【星期几（）`】（#星期几） |
| `DOW` |【星期几（）`】（#星期几） |
| `年起始日` |【年起始日（）`】（#年起始日） |
| `DOY` |【年中的第几天（）`】（#年中的第几天） |
| `年_月_周' |【周的年份（）`】（#周的年份） |
| `YOW` |【周的年份（）`】（#周的年份） |
| `小时' |【`小时（）`】（#小时） |
| `MINUTE` |【`分钟（）`】（#分钟） |
|秒(s) |【秒()】（#秒） |
| `时区_小时' | [`timezone_hour()`](#timezone_hour) |
| `TIMEZONE_MINUTE` | [`timezone_minute()`]（#时区_分钟） |

`extract`函数支持的类型根据提取的字段不同而不同。大多数字段支持所有日期和时间类型。

**提取（来自x的字段）** -\> bigint

从`x`返回`field`。

**说明**

这个SQL标准函数使用特殊的语法来指定参数。

   

便捷提取功能
--------------------------------

**day(x)** -\>大于

从`x`返回月中的第几天。


**日_月_日(x)** -\>比格因

这是`day`{.interpreted-text role="func"}的别名。


**日_月_日_周(x)** -\>大

从`x`返回一周的ISO日。取值范围：`1`（周一）~`7`（周日）。

**天\_年(x)** -\>日期

返回从`x`开始的一年中的第几天。取值范围为`1`~`366`。


**dow(x)** -\> bigint

这是`day_of_week`{.interpreted-text role="func"}的别名，即每周第几天执行。


**doy(x)** -\> bigint

这是`day_of_year`{.interpreted-text role="func"}的别名，在此处引用时，会引用该别名。


**小时(x)** -\> bigint

返回从`x`开始的一天中的小时。取值范围为`0`~`23`。


**毫秒(x)** -\> bigint

从`x`返回秒的毫秒。


**分钟(x)** -\> bigint

返回从`x`开始的整点分钟数。


**month(x)** -\>大于

返回从`x`的一年中的月份。


**quad(x)** -\> bigint工具使用说明

返回从`x`年度的季度。取值范围：`1`~
`4`.


**second(x)** -\>比格因

返回从`x`分钟的第二个。


**时区\_小时（时间戳）** -\> bigint

返回从`timestamp`偏移的时区的小时。


**时区\_分钟（时间戳）** -\> bigint

返回从`timestamp`偏移的时区的分钟。


**week(x)** -\> bigint

返回从`x`开始的一年的【ISO周】（）。取值范围：`1`
到`53`。


**星期\_of\_年(x)** -\>大于

这是`week`{.interpreted-text role="func"}的别名，方便您理解。


**年份(x)** -\> bigint

返回从`x`开始的年份。


**年\_月\_周(x)** -\>比格因

返回从`x`开始的【ISO周】（）的年份。


**yow(x)** -\>大图标

这是`year_of_week`{.interpreted-text role="func"}的别名，即“年”与“周”的别名。


【^1】：此说明符不支持`0`作为月或日。

【^2】：此说明符不支持`0`作为月或日。

【^3】：此说明符不支持`0`作为月或日。

【^4】：时间戳被截断为毫秒。

【^5】：此说明符不支持`0`作为月或日。

【^6】：暂不支持此说明符。考虑使用
`day_of_week`{.interpreted-text角色="func"}（此处使用`1-7`代替，此处省略）
（第0-6条）。

【^7】：在解析时，两位数的年份格式假定为`1970` .
`2069`，所以\"70\"将产生`1970`年，而\"69\"将产生
`2069`.
