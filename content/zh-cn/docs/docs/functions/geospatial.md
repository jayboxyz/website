地理空间函数
====================

以`ST_`为前缀的Presto Geospatial函数支持SQL/MM规范，并符合OGC OpenGIS规范。因此，许多Presto地理空间函数要求，或者更准确地说，假定操作的几何结构既简单又有效。例如，计算在多边形外定义了一个空洞的多边形的面积，或者从非简单边界构造一个多边形都是没有意义的
行。

Presto地理空间函数支持空间对象的WKT和WKB形式：

-点(0 0)
- "LINESTRING（0或1或1或12）"
-波利冈((0 0, 4 0, 4 4, 0 4, 0 0), (1 1, 2 1, 2 2, 1 2, 1 1))`
-`多点（0,12）`
-多重线（(0、11、12）,（2、3、3、5、4）)
- "多倍体"(((0 0, 4 0, 4 4, 0 4, 0 0), (1 1, 2 1, 2 2, 1 2, 1 1)), ((-1 -1, -1 -2, -2 -2, -2 -1, -1 -1)))`
-几何学收集（点(2 3），线（2 3, 3 4）)

使用`ST_GeometerFromText`和`ST_GeomFromBinary`函数从WKT或WKB创建几何对象。

`球面地理`类型提供了对*geographic*坐标（有时称为*geodetic*坐标，或*lat/lon*，或*lon/lat*），地理坐标为球面坐标，单位为角度。

几何类型的基础是一个平面。平面上两点之间的最短路径是一条直线。这意味着几何计算（面积，距离，长度，交叉口，等等）可以使用笛卡尔数学和直线向量计算。

球面地理类型的基础是一个球体。球面上两点之间的最短路径是一个大圆弧。这意味着，关于地理的计算（面积、距离、长度、交叉口等）必须在球面上计算，使用更复杂的数学。更精确的测量，考虑到实际的球体形状的世界是不支持的。

测量函数`ST_Distance`和`ST_Length`的返回值是以米为单位的，`ST_Area`的返回值是以平方米为单位的。

使用`to_sphereal_geography()`函数将几何对象转换为地理对象。

例如：`ST_Distance(ST_Point(-71.0882, 42.3607), ST_Point(-74.1197, 40.6976))`，表示距离的绝对值，即距离的绝对值。
返回`3.4577`，以欧几里得平面上传入的值为单位，
`ST_Distance（到球面的地理坐标(ST_Point(-71.0882, 42.3607）)，到球面的地理坐标(ST_Point(-74.1197, 40.6976)))``以米为单位返回`312822.179`。

构造函数
------------

**ST\_AsBinary（几何学）** -\> varbinary（变量）

返回几何体的WKB表示。


**ST\_AsText（几何学）** -\> varchar（字符串）

返回几何体的WKT表示形式。对于空的几何体，`ST_AsText（ST_LineFromText('LINESTRINGEMPTY'）)`将产生`多行线形EMPTY'`和`ST_AsText(ST_Polygon('PO (美国电影《多面体》将制作多面体电影《多面体》。

**ST\_几何学FromText(varchar)** -\>几何学

从WKT表示形式返回一个几何类型对象。

**ST\_GeomFromBinary(varbinary)** -\>几何类型

从WKB表示中返回一个几何类型对象。

**ST\_LineFromText(varchar)** -\>字符串类型

从WKT表示形式返回一个几何类型linestring对象。

**ST\_LineString（array(点）)** -\>字符串类型

返回由点数组组成的LineString。如果输入数组中少于两个非空点，则返回一个空LineString。如果数组中的任何元素为`NULL`，则抛出异常
或为空或与前一个相同。返回的几何体可能不是简单的，例如，可能自相交或可能包含重复的顶点，这取决于输入。


**ST\_多点（阵列(点）)** -\>多点

返回由指定点形成的多点几何对象。
如果输入数组为空，则返回`NULL`。如果数组中任一元素为`NULL`或空，则抛出异常。如果输入数组有重复的点，返回的几何体可能不简单，并且可能包含重复的点。

**ST\_点（双，双）** -\>点

返回具有给定坐标值的几何类型点对象。

**ST\_Polygon(varchar)** -\>多边形类型

从WKT表示形式返回几何类型多边形对象。

**to\_ballal\_geography（几何学）** -\>球面地理学

将地球半径球面上的几何对象转换为球面地理对象。该函数仅适用于二维空间中定义的`点`、`多点`、`LINESTRING`、`MULTILINESTRING`、`多角形`、`多角形`、`多角形`等几何体。或这种几何体的‘几何集合’。对于输入几何的每个点，它验证`point.x`在`[-180.0, 180.0]`范围内，`point.y`在`
，并以它们作为（经度，纬度）度数来构建球面地理结果的形状。

**to\_geometer（球体地理）** -\>几何

将球形地理对象转换为几何对象。


关系测试
------------------

**ST\_contains（几何，几何）** -\>布尔值

如果且仅当第二个几何体的点不位于第一个几何体的外侧，且第一个几何体的内侧至少有一个点位于第二个几何体的内侧时返回“真”。

**ST\_Crosses（几何学、几何学）** -\>布尔值

如果提供的几何图形具有一些（但不是全部）共同的内部点，则返回`true`。

**ST\_Disjoint（几何，几何）** -\>布尔值

如果给定的几何图形*空间上不相交，则返回`true`--如果它们不共享任何空间。

**ST\_Equals（几何学、几何学）** -\>布尔值

如果给定的几何图形表示相同的几何图形，则返回`true`。


**ST\_Intersects（几何学、几何学）** -\>布尔值

如果给定的几何体在空间上相交于两个
维数（共享空间的任何部分）和`假'，如果它们不共享空间(它们
互不相交)。


**ST\_overlaps（几何学、几何学）** -\>布尔值

如果给定的几何体共享空间，它们具有相同的维度，但彼此之间并不完全包含，则返回“true”。

**ST\_Relate（几何、几何）** -\>布尔值

如果第一个几何体与第二个几何体在空间上相关，则返回“真”。


**ST\_Touches（几何学、几何学）** -\>布尔值

如果给定的几何图形至少有一个共同点，但是它们的内部不相交，则返回`true`。


**ST\_In（几何，几何）** -\>布尔值

如果第一个几何体完全位于第二个几何体内，则返回“真”。


运营
----------

**几何\_union（array(几何）)** -\>几何

返回表示输入几何体的点集并集的几何体。与`array_agg`联合执行此函数，以首先聚合输入
几何，可能比`geometer_union_agg`更好，代价是更高的内存利用率。

**ST\_边界（几何）** -\>几何

返回此几何学的组合边界的闭包。


**ST\_Buffer（几何，距离）** -\>几何

返回表示与指定几何体的距离小于或等于指定距离的所有点的几何体。

**ST\_差异（几何，几何）** -\>几何

返回表示给定几何的点集差的几何值。

**ST\_Envelope（几何）** -\>几何

返回几何图形的矩形多边形边界。

**ST\_EnvelopeAsPts（几何）** -\>数组（几何）

返回两点的数组：几何图形的矩形多边形的左下角和右上角。如果输入的几何体为空，则返回null。

**ST\_外环（几何）** -\>几何

返回表示输入多边形外部环的线字符串。

**ST\_路口（几何，几何）** -\>几何

返回表示两个几何图形的点集交集的几何值。

**ST\_SymDifference（几何，几何）** -\>几何

返回表示两个几何图形的点集对称差的几何值。

**ST\_Union（几何，几何）** -\>几何

返回表示输入几何体的点集并集的几何体。

另见：`几何_union`,`几何_union_agg`


访问器
---------

**ST\_Area（几何）** -\>加倍

返回几何体的二维欧几里得区域。

对于Point和LineString类型，返回0.0。对于GeometryCollection类型，返回各个几何体的面积之和。

**ST\_Area（球体地理）** -\>双倍

返回多边形或多多边形的面积，以平方米为单位，使用地球的球面模型。

**ST\_Centroid（几何）** -\>几何

返回作为几何的数学质心的点值。

**ST\_ConvexHull（几何）** -\>几何

返回包含所有输入几何的最小凸几何。

**ST\_CoordDim（几何学）** -\> bigint

返回几何体的坐标维数。


**ST\_维度（几何）** -\> bigint

返回此几何对象的固有尺寸，该尺寸必须小于或等于坐标尺寸。


**ST\_距离（几何，几何）** -\>倍

返回投影单元中两个几何体之间的二维笛卡尔最小距离（基于空间参考）。


**ST\_Distance（球面地理学，球面地理学）** -\>倍

返回两个球面地理点之间的大圆距离（以米为单位）。


**ST\_几何N（几何，索引）** -\>几何

返回给定索引处的几何元素（指数从1开始）。如果几何体是几何体的集合（例如，GEOMETRYCOLLECTION或MULTI\*），则返回给定索引的几何体。如果给定的索引小于1或大于集合中的元素总数，则返回`NULL`。使用
``ST_NumGeometries冯曦找出元素的总数。奇点几何（例如，点、线、多角体）被视为一个元素的集合。空的几何图形被视为空的集合。


**ST\_InteriorRingN（几何学，索引）** -\>几何学

返回指定索引处的内部ring元素（指数从1开始）。如果给定的索引小于1或大于输入几何中内环的总数，返回`NULL`。如果输入的几何图形不是多边形，则抛出一个错误。通过`ST_NumInteriorRing冯曦找出元素总数。

**ST\_几何类型（几何）** -\> varchar

返回几何体的类型。


**ST\_IsClosed（几何）** -\>布尔类型

如果linestring的start和end点重合，则返回`true`。


**ST\_IsEmpty（几何）** -\>布尔类型

如果这个几何体是一个空的几何集合，多边形，点等等，返回“真”。

**ST\_IsSimple（几何）** -\>布尔类型

如果这个几何没有异常的几何点，如自相交或自相切，则返回`true`。

**ST\_IsRing（几何）** -\>布尔类型

如果且仅当行是封闭和简单的，则返回`true`。

**ST\_IsValid（几何）** -\>布尔值

如果且仅当输入几何体格式良好时返回`true`。使用`geometer_invalid_reason`来确定几何体没有成形的原因。

**ST\_Length（几何学）** -\>倍

在投影单元的二维平面上（基于空间参考）使用欧几里德度量返回线串或多线串的长度。

**ST\_PointN（LineString，索引）** -\>指针类型

返回在给定索引处（指数从1开始）的线串顶点。如果给定的索引小于1或大于集合中的元素总数，则返回`NULL`。使用`` ST_NumPoints ``找出元素总数。

**ST\_Points（几何）** -\>数组（点）

返回linestring中的point数组。


**ST\_XMax（几何学）** -\>加倍

返回几何包围盒的X极大值。


**ST\_YMax（几何）** -\>倍率

返回几何包围盒的Y极大值。


**ST\_XMin（几何）** -\>加倍

返回几何包围盒的X极小值。


**ST\_YMin（几何）** -\>加倍

返回几何包围盒的Y极小值。


**ST\_StartPoint（几何学）** -\>点

以Point形式返回LineString几何体的第一个点。这是ST\_PointN（几何，1）的快捷方式。

**简化\_几何（几何，double）** -\>几何

使用Douglas-Peucker算法返回输入的几何图形的“简化”版本。将避免创建派生几何（特别是多边形）是无效的。

**ST\_EndPoint（几何学）** -\>点

以Point形式返回LineString几何图形的最后一个点。这是ST\_PointN（几何，ST\_NumPoints(几何）)的快捷方式。

**ST\_X（点）** -\>加倍

返回点的X坐标。

**ST\_Y（点）** -\>双倍

返回点的Y坐标。

**ST\_InteriorRings（几何学）** -\>几何学

返回在输入几何中找到的所有内部环的数组，如果多边形没有内部环，则返回空数组。如果输入的几何体为空，则返回null。如果输入的几何图形不是
多边形。


**ST\_数字几何（几何）** -\> bigint

返回集合中几何体的数目。如果几何体是几何体的集合（例如，GEOMETRYCOLLECTION或MULTI\*），返回几何体的数量，对于单个几何体返回1，对于空几何体返回0。


**ST\_几何学（几何学）** -\>几何学

返回指定集合中的几何图形数组。如果输入的几何体不是多几何体，则返回一个单元素数组。如果输入的几何体为空，则返回null。

**ST\_NumPoints（几何学）** -\> bigint

返回几何图形中的点数。这是对SQL/MM`ST_NumPoints`函数的扩展，该函数只适用于point和linestring。


**ST\_NumInteriorRing（几何学）** -\> bigint

返回多边形内环集合的基数。

**line\_locate\_point（LineString，指针）** -\>双精度浮点数

返回一个介于0和1之间的浮点数，它表示LineString上距离给定Point最近的点的位置，作为总2d线长的一部分。

如果LineString或Point为空或`NULL`，则返回`NULL`。

**几何学\_invalid\_reason（几何学）** -\> varchar类型

返回输入几何体无效的原因。如果输入有效，则返回null。

**great\_circle\_distance（纬度1，经度1，纬度2，经度2）**-\>双精度浮点数

返回地球表面两点间以公里为单位的大圆距离。


聚合
------------

**凸面\_外壳\_agg（几何）** -\>几何

返回包含所有输入几何的最小凸几何。


**几何\_union\_agg（几何）** -\>几何

返回表示所有输入几何图形的点集并集的几何图形。


冰砖
----------

这些函数在几何图形和【Bing tiles】（https://msdn.microsoft.com/en-us/library/bb259689.aspx）之间进行转换。

**bing\_tile(x,y,zoom\_level)** -\>必应贴纸块

从XY坐标和缩放级别创建必应贴图对象。支持1~23级变焦。

**bing\_tile(quadKey)** -\>必应贴

从四元组创建必应砖块对象。

**bing\_tile\_at（纬度，经度，缩放\_level）** -\>必应牌

在给定的缩放级别上返回一个Bing平铺，其中包含给定纬度和经度上的一个点。纬度必须在`[-85.05112878, 85.05112878]`范围内。经度必须在`[-180,180]`范围内。支持1~23级变焦。

**bing\_tiles\_around（纬度、经度、缩放级别）** -\>数组（平铺）

在给定缩放级别上，返回围绕由纬度和经度参数指定的点的必应贴片的集合。

**bing\_tiles\_around（纬度、经度、缩放级别、半径大小）** -\>数组(BingTile)

返回在指定的缩放级别上的最小必应贴图集，该贴图覆盖指定（纬度、经度）点周围以千米为单位的指定半径的圆。


**bing\_tile\_坐标（平铺）** -\>行\<x, y\>

返回给定Bingtile的XY坐标。


**bing\_tile\_多边形（平铺）** -\>几何

返回给定Bing平铺的多边形表示形式。


**bing\_tile\_quadkey(tile)文件夹文件夹名称** -\> varchar

返回给定必应牌的四元组。


**bing\_tile\_zoom\_级别（平铺）** -\> tinyint，即云图地图地图地图

返回给定Bing平铺的缩放级别。


**几何\_to\_bing\_tiles（几何，缩放\_level）** -\>数组（平铺）

返回在给定缩放级别完全覆盖给定几何体的最小必应贴图集。支持1~23级变焦。

